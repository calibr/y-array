/**
 * y-array - Array Type for Yjs
 * @version v11.0.0-4
 * @license MIT
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.yArray=e()}(this,function(){"use strict";function t(t){t.utils.yarrayEventHandler=function(e){var n=this;if("Insert"===e.struct){if(this._content.some(function(n){return t.utils.compareIds(n.id,e.id)}))return;var r=void 0;if(null===e.left)r=0;else if((r=1+this._content.findIndex(function(n){return t.utils.compareIds(n.id,e.left)}))<=0)throw new Error("Unexpected operation!");var i,o;if(e.hasOwnProperty("opContent")){this._content.splice(r,0,{id:e.id,type:e.opContent}),o=1;var s=this.os.getType(e.opContent);s._parent=this._model,i=[s]}else{var l=e.content.map(function(t,n){return{id:[e.id[0],e.id[1]+n],val:t}});l.length<3e4?this._content.splice.apply(this._content,[r,0].concat(l)):this._content=this._content.slice(0,r).concat(l).concat(this._content.slice(r)),i=e.content,o=e.content.length}t.utils.bubbleEvent(this,{type:"insert",object:this,index:r,values:i,length:o})}else{if("Delete"!==e.struct)throw new Error("Unexpected struct!");for(var a=0;a<this._content.length&&e.length>0;a++){var u=this._content[a];if(t.utils.inDeletionRange(e,u.id)){var c;for(c=1;c<e.length&&a+c<this._content.length&&t.utils.inDeletionRange(e,this._content[a+c].id);c++);u=this._content[a+c-1],e.length-=u.id[1]-e.target[1]+1,e.target=[u.id[0],u.id[1]+1];var h=this._content.splice(a,c),f=h.map(function(t){return null!=t.val?t.val:n.os.getType(t.type)});t.utils.bubbleEvent(this,{type:"delete",object:this,index:a,values:f,_content:h,length:c})}}}};var o=function(o){function s(n,r,o){e(this,s);var l=i(this,(s.__proto__||Object.getPrototypeOf(s)).call(this));return l.os=n,l._model=r,l._content=o,l._parent=null,l._deepEventHandler=new t.utils.EventListenerHandler,l.eventHandler=new t.utils.EventHandler(t.utils.yarrayEventHandler.bind(l)),l}return r(s,o),n(s,[{key:"_getPathToChild",value:function(e){return this._content.findIndex(function(n){return null!=n.type&&t.utils.compareIds(n.type,e)})}},{key:"_destroy",value:function(){this.eventHandler.destroy(),this.eventHandler=null,this._content=null,this._model=null,this._parent=null,this.os=null}},{key:"get",value:function(t){if(null==t||"number"!=typeof t)throw new Error("pos must be a number!");if(!(t>=this._content.length))return null==this._content[t].type?this._content[t].val:this.os.getType(this._content[t].type)}},{key:"toArray",value:function(){var t=this;return this._content.map(function(e,n){return null!=e.type?t.os.getType(e.type):e.val})}},{key:"push",value:function(t){return this.insert(this._content.length,t)}},{key:"insert",value:function(e,n){if("number"!=typeof e)throw new Error("pos must be a number!");if(!Array.isArray(n))throw new Error("contents must be an Array of objects!");if(0!==n.length){if(e>this._content.length||e<0)throw new Error("This position exceeds the range of the array!");for(var r=0===e?null:this._content[e-1].id,i=[],o=r,s=0;s<n.length;){for(var l,a={left:o,origin:o,parent:this._model,struct:"Insert"},u=[];s<n.length;){var c=n[s++];if(l=t.utils.isTypeDefinition(c)){if(u.length>0){s--;break}break}u.push(c)}if(u.length>0)a.content=u,a.id=this.os.getNextOpId(u.length);else{var h=this.os.getNextOpId(1);this.os.createType(l,h),a.opContent=h,a.id=this.os.getNextOpId(1)}i.push(a),o=a.id}var f=this.eventHandler;this.os.requestTransaction(function(){var t;if(null!=r){t=this.getInsertionCleanEnd(r).right}else t=this.getOperation(i[0].parent).start;for(var e=0;e<i.length;e++){i[e].right=t}f.awaitOps(this,this.applyCreatedOperations,[i])}),f.awaitAndPrematurelyCall(i)}}},{key:"delete",value:function(e,n){if(null==n&&(n=1),"number"!=typeof n)throw new Error("length must be a number!");if("number"!=typeof e)throw new Error("pos must be a number!");if(e+n>this._content.length||e<0||n<0)throw new Error("The deletion range exceeds the range of the array!");if(0!==n){for(var r,i=this.eventHandler,o=[],s=0;s<n;s+=r){var l=this._content[e+s].id;for(r=1;s+r<n&&t.utils.compareIds(this._content[e+s+r].id,[l[0],l[1]+r]);r++);o.push({target:l,struct:"Delete",length:r})}this.os.requestTransaction(function(){i.awaitOps(this,this.applyCreatedOperations,[o])}),i.awaitAndPrematurelyCall(o)}}},{key:"observe",value:function(t){this.eventHandler.addEventListener(t)}},{key:"observeDeep",value:function(t){this._deepEventHandler.addEventListener(t)}},{key:"unobserve",value:function(t){this.eventHandler.removeEventListener(t)}},{key:"unobserveDeep",value:function(t){this._deepEventHandler.removeEventListener(t)}},{key:"_changed",value:function(t,e){if(!e.deleted){if("Insert"===e.struct){for(var n,r=e.left;null!=r&&(n=t.getInsertion(r),n.deleted);)r=n.left;e.left=r,null!=e.opContent&&t.store.initType.call(t,e.opContent)}this.eventHandler.receivedOp(e)}}},{key:"length",get:function(){return this._content.length}}]),s}(t.utils.CustomType);t.extend("Array",new t.utils.CustomTypeDefinition({name:"Array",class:o,struct:"List",initType:function(e,n){var r=[],i=[];t.Struct.List.map.call(this,n,function(t){t.hasOwnProperty("opContent")?(r.push({id:t.id,type:t.opContent}),i.push(t.opContent)):t.content.forEach(function(e,n){r.push({id:[t.id[0],t.id[1]+n],val:t.content[n]})})});for(var s=0;s<i.length;s++){this.store.initType.call(this,i[s])._parent=n.id}return new o(e,n.id,r)},createType:function(t,e){return new o(t,e.id,[])}}))}var e=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},n=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),r=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)},i=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e};return"undefined"!=typeof Y&&t(Y),t});
//# sourceMappingURL=y-array.js.map
