{"version":3,"file":"y-array.node.js","sources":["src/y-array.js"],"sourcesContent":["/* global Y */\n\nfunction extend (Y) {\n  class YArray extends Y.utils.CustomType {\n    constructor (os, _model, _content) {\n      super()\n      this.os = os\n      this._model = _model\n      // Array of all the neccessary content\n      this._content = _content\n\n      // the parent of this type\n      this._parent = null\n      this._deepEventHandler = new Y.utils.EventListenerHandler()\n\n      // this._debugEvents = [] // TODO: remove!!\n      this.eventHandler = new Y.utils.EventHandler((op) => {\n        // this._debugEvents.push(JSON.parse(JSON.stringify(op)))\n        if (op.struct === 'Insert') {\n          // when using indexeddb db adapter, the op could already exist (see y-js/y-indexeddb#2)\n          if (this._content.some(function (c) { return Y.utils.compareIds(c.id, op.id) })) {\n            // op exists\n            return\n          }\n          let pos\n          // we check op.left only!,\n          // because op.right might not be defined when this is called\n          if (op.left === null) {\n            pos = 0\n          } else {\n            pos = 1 + this._content.findIndex(function (c) {\n              return Y.utils.compareIds(c.id, op.left)\n            })\n            if (pos <= 0) {\n              throw new Error('Unexpected operation!')\n            }\n          }\n\n          /*\n          (see above for new approach)\n          var _e = this._content[pos]\n          // when using indexeddb db adapter, the op could already exist (see y-js/y-indexeddb#2)\n          // If the algorithm works correctly, the double should always exist on the correct position (pos - the computed destination)\n          if (_e != null && Y.utils.compareIds(_e.id, op.id)) {\n            // is already defined\n            return\n          }\n          */\n          var values\n          var length\n          if (op.hasOwnProperty('opContent')) {\n            this._content.splice(pos, 0, {\n              id: op.id,\n              type: op.opContent\n            })\n            length = 1\n            let type = this.os.getType(op.opContent)\n            type._parent = this._model\n            values = [type]\n          } else {\n            var contents = op.content.map(function (c, i) {\n              return {\n                id: [op.id[0], op.id[1] + i],\n                val: c\n              }\n            })\n            // insert value in _content\n            // It is not possible to insert more than ~2^16 elements in an Array (see #5). We handle this case explicitly\n            if (contents.length < 30000) {\n              this._content.splice.apply(this._content, [pos, 0].concat(contents))\n            } else {\n              this._content = this._content.slice(0, pos).concat(contents).concat(this._content.slice(pos))\n            }\n            values = op.content\n            length = op.content.length\n          }\n          Y.utils.bubbleEvent(this, {\n            type: 'insert',\n            object: this,\n            index: pos,\n            values: values,\n            length: length\n          })\n        } else if (op.struct === 'Delete') {\n          var i = 0 // current position in _content\n          for (; i < this._content.length && op.length > 0; i++) {\n            var c = this._content[i]\n            if (Y.utils.inDeletionRange(op, c.id)) {\n              // is in deletion range!\n              var delLength\n              // check how many character to delete in one flush\n              for (delLength = 1;\n                    delLength < op.length && i + delLength < this._content.length && Y.utils.inDeletionRange(op, this._content[i + delLength].id);\n                    delLength++) {}\n              // last operation that will be deleted\n              c = this._content[i + delLength - 1]\n              // update delete operation\n              op.length -= c.id[1] - op.target[1] + 1\n              op.target = [c.id[0], c.id[1] + 1]\n              // apply deletion & find send event\n              let content = this._content.splice(i, delLength)\n              let values = content.map((c) => {\n                if (c.val != null) {\n                  return c.val\n                } else {\n                  return this.os.getType(c.type)\n                }\n              })\n              Y.utils.bubbleEvent(this, {\n                type: 'delete',\n                object: this,\n                index: i,\n                values: values,\n                _content: content,\n                length: delLength\n              })\n              // with the fresh delete op, we can continue\n              // note: we don't have to increment i, because the i-th content was deleted\n              // but on the other had, the (i+delLength)-th was not in deletion range\n              // So we don't do i--\n            }\n          }\n        } else {\n          throw new Error('Unexpected struct!')\n        }\n      })\n    }\n    _getPathToChild (childId) {\n      return this._content.findIndex(c =>\n        c.type != null && Y.utils.compareIds(c.type, childId)\n      )\n    }\n    _destroy () {\n      this.eventHandler.destroy()\n      this.eventHandler = null\n      this._content = null\n      this._model = null\n      this._parent = null\n      this.os = null\n    }\n    get length () {\n      return this._content.length\n    }\n    get (pos) {\n      if (pos == null || typeof pos !== 'number') {\n        throw new Error('pos must be a number!')\n      }\n      if (pos >= this._content.length) {\n        return undefined\n      }\n      if (this._content[pos].type == null) {\n        return this._content[pos].val\n      } else {\n        return this.os.getType(this._content[pos].type)\n      }\n    }\n    toArray () {\n      return this._content.map((x, i) => {\n        if (x.type != null) {\n          return this.os.getType(x.type)\n        } else {\n          return x.val\n        }\n      })\n    }\n    push (contents) {\n      return this.insert(this._content.length, contents)\n    }\n    insert (pos, contents) {\n      if (typeof pos !== 'number') {\n        throw new Error('pos must be a number!')\n      }\n      if (!Array.isArray(contents)) {\n        throw new Error('contents must be an Array of objects!')\n      }\n      if (contents.length === 0) {\n        return\n      }\n      if (pos > this._content.length || pos < 0) {\n        throw new Error('This position exceeds the range of the array!')\n      }\n      var mostLeft = pos === 0 ? null : this._content[pos - 1].id\n\n      var ops = []\n      var prevId = mostLeft\n      for (var i = 0; i < contents.length;) {\n        var op = {\n          left: prevId,\n          origin: prevId,\n          // right: mostRight,\n          // NOTE: I intentionally do not define right here, because it could be deleted\n          // at the time of inserting this operation (when we get the transaction),\n          // and would therefore not defined in this._content\n          parent: this._model,\n          struct: 'Insert'\n        }\n        var _content = []\n        var typeDefinition\n        while (i < contents.length) {\n          var val = contents[i++]\n          typeDefinition = Y.utils.isTypeDefinition(val)\n          if (!typeDefinition) {\n            _content.push(val)\n          } else if (_content.length > 0) {\n            i-- // come back again later\n            break\n          } else {\n            break\n          }\n        }\n        if (_content.length > 0) {\n          // content is defined\n          op.content = _content\n          op.id = this.os.getNextOpId(_content.length)\n        } else {\n          // otherwise its a type\n          var typeid = this.os.getNextOpId(1)\n          this.os.createType(typeDefinition, typeid)\n          op.opContent = typeid\n          op.id = this.os.getNextOpId(1)\n        }\n        ops.push(op)\n        prevId = op.id\n      }\n      var eventHandler = this.eventHandler\n      this.os.requestTransaction(function * () {\n        // now we can set the right reference.\n        var mostRight\n        if (mostLeft != null) {\n          var ml = yield * this.getInsertionCleanEnd(mostLeft)\n          mostRight = ml.right\n        } else {\n          mostRight = (yield * this.getOperation(ops[0].parent)).start\n        }\n        for (var j = 0; j < ops.length; j++) {\n          var op = ops[j]\n          op.right = mostRight\n        }\n        yield * eventHandler.awaitOps(this, this.applyCreatedOperations, [ops])\n      })\n      // always remember to do that after this.os.requestTransaction\n      // (otherwise values might contain a undefined reference to type)\n      eventHandler.awaitAndPrematurelyCall(ops)\n    }\n    delete (pos, length) {\n      if (length == null) { length = 1 }\n      if (typeof length !== 'number') {\n        throw new Error('length must be a number!')\n      }\n      if (typeof pos !== 'number') {\n        throw new Error('pos must be a number!')\n      }\n      if (pos + length > this._content.length || pos < 0 || length < 0) {\n        throw new Error('The deletion range exceeds the range of the array!')\n      }\n      if (length === 0) {\n        return\n      }\n      var eventHandler = this.eventHandler\n      var dels = []\n      var delLength\n      for (var i = 0; i < length; i = i + delLength) {\n        var targetId = this._content[pos + i].id\n        // how many insertions can we delete in one deletion?\n        for (delLength = 1; i + delLength < length; delLength++) {\n          if (!Y.utils.compareIds(this._content[pos + i + delLength].id, [targetId[0], targetId[1] + delLength])) {\n            break\n          }\n        }\n        dels.push({\n          target: targetId,\n          struct: 'Delete',\n          length: delLength\n        })\n      }\n      this.os.requestTransaction(function * () {\n        yield * eventHandler.awaitOps(this, this.applyCreatedOperations, [dels])\n      })\n      // always remember to do that after this.os.requestTransaction\n      // (otherwise values might contain a undefined reference to type)\n      eventHandler.awaitAndPrematurelyCall(dels)\n    }\n    observe (f) {\n      this.eventHandler.addEventListener(f)\n    }\n    observeDeep (f) {\n      this._deepEventHandler.addEventListener(f)\n    }\n    unobserve (f) {\n      this.eventHandler.removeEventListener(f)\n    }\n    unobserveDeep (f) {\n      this._deepEventHandler.removeEventListener(f)\n    }\n    * _changed (transaction, op) {\n      if (!op.deleted) {\n        if (op.struct === 'Insert') {\n          // update left\n          var l = op.left\n          var left\n          while (l != null) {\n            left = yield * transaction.getInsertion(l)\n            if (!left.deleted) {\n              break\n            }\n            l = left.left\n          }\n          op.left = l\n          // if op contains opContent, initialize it\n          if (op.opContent != null) {\n            yield * transaction.store.initType.call(transaction, op.opContent)\n          }\n        }\n        this.eventHandler.receivedOp(op)\n      }\n    }\n  }\n\n  Y.extend('Array', new Y.utils.CustomTypeDefinition({\n    name: 'Array',\n    class: YArray,\n    struct: 'List',\n    initType: function * YArrayInitializer (os, model) {\n      var _content = []\n      var _types = []\n      yield * Y.Struct.List.map.call(this, model, function (op) {\n        if (op.hasOwnProperty('opContent')) {\n          _content.push({\n            id: op.id,\n            type: op.opContent\n          })\n          _types.push(op.opContent)\n        } else {\n          op.content.forEach(function (c, i) {\n            _content.push({\n              id: [op.id[0], op.id[1] + i],\n              val: op.content[i]\n            })\n          })\n        }\n      })\n      for (var i = 0; i < _types.length; i++) {\n        var type = yield * this.store.initType.call(this, _types[i])\n        type._parent = model.id\n      }\n      return new YArray(os, model.id, _content)\n    },\n    createType: function YArrayCreateType (os, model) {\n      return new YArray(os, model.id, [])\n    }\n  }))\n}\n\nexport default extend\nif (typeof Y !== 'undefined') {\n  extend(Y)\n}\n"],"names":[],"mappings":"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"}